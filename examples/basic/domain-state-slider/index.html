<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Domain State Slider - UIstate Example</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="state.css">
</head>
<body>
  <h1>Domain State Slider Example</h1>
  <p><a href="../../../docs/examples/domain-state-slider.html">Docs</a></p>
  
  <div class="domain-slider-container" data-uis-value="50" data-uis-min="0" data-uis-max="100" data-active-domain="medium" style="--domain-position: 0.5;">
    <div class="domain-sections">
      <div class="domain-section" data-domain="muted" data-domain-start="0" data-domain-end="10">
        <span class="domain-label">Muted</span>
      </div>
      <div class="domain-section" data-domain="low" data-domain-start="11" data-domain-end="30">
        <span class="domain-label">Low</span>
      </div>
      <div class="domain-section" data-domain="medium" data-domain-start="31" data-domain-end="70">
        <span class="domain-label">Medium</span>
      </div>
      <div class="domain-section" data-domain="high" data-domain-start="71" data-domain-end="85">
        <span class="domain-label">High</span>
      </div>
      <div class="domain-section" data-domain="maximum" data-domain-start="86" data-domain-end="100">
        <span class="domain-label">Maximum</span>
      </div>
    </div>
    
    <div class="slider-track">
      <div class="slider-fill"></div>
      <div class="slider-thumb"></div>
    </div>
    
    <div class="value-display">
      <div class="current-value">50</div>
      <div class="current-domain">Medium</div>
    </div>
    
    <div class="domain-indicator">
      <div class="domain-description">
        <h3>Medium Intensity</h3>
        <p>This represents a moderate level suitable for regular use.</p>
      </div>
      <div class="domain-icon"></div>
    </div>
  </div>

  <script>
    // Get references to elements
    const container = document.querySelector('.domain-slider-container');
    const valueDisplay = document.querySelector('.current-value');
    const domainDisplay = document.querySelector('.current-domain');
    const thumb = document.querySelector('.slider-thumb');
    const track = document.querySelector('.slider-track');
    const fill = document.querySelector('.slider-fill');
    
    // Domain definitions - these could also be extracted from the section data attributes
    const domains = [
      { name: 'muted', start: 0, end: 10, label: 'Muted', description: 'Very subtle effect, barely noticeable.' },
      { name: 'low', start: 11, end: 30, label: 'Low', description: 'Light effect, suitable for background use.' },
      { name: 'medium', start: 31, end: 70, label: 'Medium', description: 'This represents a moderate level suitable for regular use.' },
      { name: 'high', start: 71, end: 85, label: 'High', description: 'Strong effect, good for emphasis and highlights.' },
      { name: 'maximum', start: 86, end: 100, label: 'Maximum', description: 'Maximum intensity, use sparingly for critical elements.' }
    ];
    
    // Initialize from data attributes
    updateSliderPosition();
    updateActiveDomain();
    
    // Add event listeners for mouse/touch interactions
    thumb.addEventListener('mousedown', startDrag);
    track.addEventListener('click', jumpToPosition);
    
    // Add event listeners for domain section clicks
    document.querySelectorAll('.domain-section').forEach(section => {
      section.addEventListener('click', (e) => {
        // Prevent this from triggering the track click event
        e.stopPropagation();
        
        const domainStart = parseInt(section.dataset.domainStart);
        const domainEnd = parseInt(section.dataset.domainEnd);
        const midValue = Math.floor((domainStart + domainEnd) / 2);
        
        // Set to middle of the clicked domain
        container.setAttribute('data-uis-value', midValue);
        
        // Update the UI
        updateSliderPosition();
        updateActiveDomain();
      });
    });
    
    // Function to start dragging the thumb
    function startDrag(e) {
      e.preventDefault();
      
      // Add event listeners for drag and release
      document.addEventListener('mousemove', drag);
      document.addEventListener('mouseup', stopDrag);
      
      // Store initial position for drag calculation
      const initialX = e.clientX;
      const initialValue = parseInt(container.getAttribute('data-uis-value'));
      
      // Drag function
      function drag(e) {
        const trackRect = track.getBoundingClientRect();
        const min = parseInt(container.getAttribute('data-uis-min'));
        const max = parseInt(container.getAttribute('data-uis-max'));
        const trackWidth = trackRect.width;
        
        // Calculate new position based on drag distance
        const dragDistance = e.clientX - initialX;
        const dragRatio = dragDistance / trackWidth;
        const valueRange = max - min;
        const valueDelta = dragRatio * valueRange;
        
        // Calculate new value and constrain to min/max
        let newValue = Math.round(initialValue + valueDelta);
        newValue = Math.max(min, Math.min(max, newValue));
        
        // Update the data attribute (source of truth)
        container.setAttribute('data-uis-value', newValue);
        
        // Update the UI
        updateSliderPosition();
        updateActiveDomain();
      }
      
      // Stop drag function
      function stopDrag() {
        document.removeEventListener('mousemove', drag);
        document.removeEventListener('mouseup', stopDrag);
      }
    }
    
    // Function to jump to clicked position
    function jumpToPosition(e) {
      const trackRect = track.getBoundingClientRect();
      const min = parseInt(container.getAttribute('data-uis-min'));
      const max = parseInt(container.getAttribute('data-uis-max'));
      const trackWidth = trackRect.width;
      
      // Calculate click position relative to track
      const clickX = e.clientX - trackRect.left;
      const clickRatio = clickX / trackWidth;
      
      // Calculate new value and constrain to min/max
      let newValue = Math.round(min + clickRatio * (max - min));
      newValue = Math.max(min, Math.min(max, newValue));
      
      // Update the data attribute (source of truth)
      container.setAttribute('data-uis-value', newValue);
      
      // Update the UI
      updateSliderPosition();
      updateActiveDomain();
    }
    
    // Function to update slider position based on data attribute
    function updateSliderPosition() {
      const value = parseInt(container.getAttribute('data-uis-value'));
      const min = parseInt(container.getAttribute('data-uis-min'));
      const max = parseInt(container.getAttribute('data-uis-max'));
      
      // Calculate position percentage
      const percentage = ((value - min) / (max - min)) * 100;
      
      // Update CSS variable for position
      container.style.setProperty('--slider-position', `${percentage}%`);
      
      // Update value display
      valueDisplay.textContent = value;
    }
    
    // Function to update active domain based on current value
    function updateActiveDomain() {
      const value = parseInt(container.getAttribute('data-uis-value'));
      
      // Find the domain that contains the current value
      let activeDomain = null;
      let domainDescription = '';
      
      for (const domain of domains) {
        if (value >= domain.start && value <= domain.end) {
          activeDomain = domain;
          break;
        }
      }
      
      if (!activeDomain) return;
      
      // Update the active domain attribute (derived state)
      container.setAttribute('data-active-domain', activeDomain.name);
      
      // Calculate position within domain (0-1)
      const domainRange = activeDomain.end - activeDomain.start;
      const positionInDomain = (value - activeDomain.start) / domainRange;
      container.style.setProperty('--domain-position', positionInDomain);
      
      // Update domain display
      domainDisplay.textContent = activeDomain.label;
      
      // Update domain description
      document.querySelector('.domain-description h3').textContent = `${activeDomain.label} Intensity`;
      document.querySelector('.domain-description p').textContent = activeDomain.description;
      
      // Update section active states in the DOM
      document.querySelectorAll('.domain-section').forEach(section => {
        if (section.dataset.domain === activeDomain.name) {
          section.classList.add('active');
        } else {
          section.classList.remove('active');
        }
      });
    }
  </script>
</body>
</html>
